{
  "name": "Multi Language Translator",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "translate",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "b99c378f-e2b2-4a0f-ac9a-2198c9159c6b",
      "name": "ç¿»è¯‘è¯·æ±‚",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        720,
        120
      ],
      "webhookId": "translate-complete"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://host.docker.internal:8000/v1/chat/completions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"gemini-2.5-pro\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"ä½ æ˜¯ä¸“ä¸šçš„ç¿»è¯‘åŠ©æ‰‹ã€‚è¯·å°†ç”¨æˆ·æä¾›çš„æ–‡æœ¬ç¿»è¯‘æˆå¸¸ç”¨è¯­è¨€ã€‚è¯·ç”¨JSONæ ¼å¼è¿”å›ç¿»è¯‘ç»“æœã€‚\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"è¯·å°† {{ $('ç¿»è¯‘è¯·æ±‚').item.json.body.text }}ï¼Œç¿»è¯‘æˆ {{ $('ç¿»è¯‘è¯·æ±‚').item.json.body.target_languages.join(',') }}\"\n    }\n  ],\n  \"project_id\": \"{{ $json.project_id }}\"\n}",
        "options": {
          "timeout": 30000
        }
      },
      "id": "abb91ddd-a096-4248-9ac5-f3e55839de50",
      "name": "Gemini ç¿»è¯‘",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1220,
        120
      ]
    },
    {
      "parameters": {
        "jsCode": "// è·å–æ•°æ®\nconst geminiResponse = $input.all()[0].json;\nconst translationText = geminiResponse.choices[0].message.content;\nconst webhookData = $('ç¿»è¯‘è¯·æ±‚').all()[0].json;\n\n// å¤„ç†æ¢è¡Œç¬¦\nconst cleanText = translationText.replace(/\\\\n/g, '\\n');\n\n// ä¿®å¤ï¼šæ•°æ®åœ¨ body é‡Œé¢ï¼\nconst requestBody = webhookData.body || webhookData;\nconst originalText = requestBody.text;\nconst originalLanguages = requestBody.target_languages || [];\n\nconsole.log(\"=== ä¿®å¤åçš„æ•°æ®è·å– ===\");\nconsole.log(\"requestBody:\", requestBody);\nconsole.log(\"originalLanguages:\", originalLanguages);\n\n// è¯­è¨€æ˜ å°„\nconst languageMapping = {\n  \"ä¸­æ–‡\": \"Chinese\", \"Chinese\": \"Chinese\",\n  \"æ—¥è¯­\": \"Japanese\", \"æ—¥æ–‡\": \"Japanese\", \"Japanese\": \"Japanese\", \"æ—¥æœ¬èª\": \"Japanese\",\n  \"éŸ©è¯­\": \"Korean\", \"éŸ©æ–‡\": \"Korean\", \"Korean\": \"Korean\", \"í•œêµ­ì–´\": \"Korean\", \n  \"æ³•è¯­\": \"French\", \"æ³•æ–‡\": \"French\", \"French\": \"French\", \"FranÃ§ais\": \"French\",\n  \"å¾·è¯­\": \"German\", \"å¾·æ–‡\": \"German\", \"German\": \"German\", \"Deutsch\": \"German\",\n  \"è‹±è¯­\": \"English\", \"è‹±æ–‡\": \"English\", \"English\": \"English\"\n};\n\n// è¯­è¨€æ£€æµ‹æ¨¡å¼\nconst languagePatterns = {\n  \"Chinese\": [\"ä¸­æ–‡\", \"Chinese\"],\n  \"Japanese\": [\"æ—¥è¯­\", \"æ—¥æ–‡\", \"Japanese\", \"æ—¥æœ¬èª\"],\n  \"Korean\": [\"éŸ©è¯­\", \"éŸ©æ–‡\", \"Korean\", \"í•œêµ­ì–´\"],\n  \"French\": [\"æ³•è¯­\", \"æ³•æ–‡\", \"French\", \"FranÃ§ais\"], \n  \"German\": [\"å¾·è¯­\", \"å¾·æ–‡\", \"German\", \"Deutsch\"],\n  \"English\": [\"è‹±è¯­\", \"è‹±æ–‡\", \"English\"]\n};\n\n// æ ‡å‡†åŒ–è¯­è¨€åç§°\nfunction normalizeLanguages(inputLanguages) {\n  return inputLanguages.map(lang => {\n    return languageMapping[lang] || languageMapping[lang.toLowerCase()] || lang;\n  });\n}\n\n// åŠ¨æ€æå–ç¿»è¯‘\nfunction extractTranslationsDynamically(text, normalizedLanguages) {\n  const translations = {};\n  const lines = text.split('\\n');\n  \n  normalizedLanguages.forEach(targetLang => {\n    const patterns = languagePatterns[targetLang] || [targetLang];\n    \n    lines.forEach(line => {\n      const trimmedLine = line.trim();\n      \n      if (trimmedLine.includes(':**') && !translations[targetLang]) {\n        const hasLanguage = patterns.some(pattern => \n          trimmedLine.toLowerCase().includes(pattern.toLowerCase())\n        );\n        \n        if (hasLanguage) {\n          const afterColon = trimmedLine.split(':**')[1];\n          if (afterColon) {\n            translations[targetLang] = afterColon.trim();\n          }\n        }\n      }\n    });\n  });\n  \n  return translations;\n}\n\n// å¤„ç†è¯­è¨€æ ‡å‡†åŒ–\nconst normalizedLanguages = normalizeLanguages(originalLanguages);\n\n// æå–ç¿»è¯‘\nlet translations = extractTranslationsDynamically(cleanText, normalizedLanguages);\n\n// æ„å»ºè¿”å›ç»“æœ\nconst result = {\n  success: true,\n  original_text: originalText,\n  requested_languages: normalizedLanguages,\n  translations: translations,\n  extracted_count: Object.keys(translations).length,\n  timestamp: new Date().toISOString(),\n  model_used: geminiResponse.model,\n  request_id: geminiResponse.id\n};\n\nreturn {\n  json: result\n};"
      },
      "id": "40492fc4-2a4b-40fb-934b-d31e94607d30",
      "name": "æ ¼å¼åŒ–ç¿»è¯‘ç»“æœ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1460,
        120
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "id": "1c53fdd1-55e1-4dc7-a156-1fa597b357ee",
      "name": "è¿”å›ç¿»è¯‘ç»“æœ",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        1680,
        120
      ]
    },
    {
      "parameters": {},
      "id": "69b49d3c-1e17-4385-b179-8db11608153b",
      "name": "é”™è¯¯å¤„ç†",
      "type": "n8n-nodes-base.errorTrigger",
      "typeVersion": 1,
      "position": [
        1040,
        320
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"success\": false,\n  \"error\": \"{{ $json.error?.message || 'Unknown error' }}\",\n  \"timestamp\": \"{{ new Date().toISOString() }}\",\n  \"details\": \"Gemini CLI æœåŠ¡å¯èƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•\"\n}",
        "options": {}
      },
      "id": "5a96dd26-ddc9-43ca-a4d8-9e8afb5ad08a",
      "name": "é”™è¯¯å“åº”",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        1300,
        320
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "eb469860-ec95-44aa-864d-4725ce567a65",
              "name": "project_id",
              "value": "YOUR_GOOGLE_CLOUD_PROJECT",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        980,
        120
      ],
      "id": "6ce4924a-f945-42ae-b289-5aad3d0713b8",
      "name": "è®¾ç½® Google Cloud é¡¹ç›®ID"
    },
    {
      "parameters": {
        "content": "# ğŸŒ n8n + Gemini æ™ºèƒ½ç¿»è¯‘æœåŠ¡\n\n## ğŸ“‹ åŸºæœ¬ä¿¡æ¯\n- **å·¥ä½œæµåç§°**: Smart Translate API \n- **ç‰ˆæœ¬**: v0.0.1\n- **åˆ›å»ºè€…**: LQ\n- **å¾®ä¿¡**ï¼šcloud-native-101\n- **å…¬ä¼—å·**: æ—æœˆåŠå­çš„AIç¬”è®°\n\n## ğŸ¯ åŠŸèƒ½æ¦‚è¿°\nåŸºäº Google Gemini API æ„å»ºçš„å¤šè¯­è¨€ç¿»è¯‘æœåŠ¡ï¼Œé€šè¿‡ Webhook æ¥å£æä¾›å®æ—¶ç¿»è¯‘åŠŸèƒ½ã€‚æ”¯æŒä¸­æ–‡ã€è‹±è¯­ã€æ—¥è¯­ã€éŸ©è¯­ã€æ³•è¯­ã€å¾·è¯­ç­‰å¤šç§è¯­è¨€äº’è¯‘ï¼Œè¿”å›ç»“æ„åŒ–JSONæ ¼å¼çš„ç¿»è¯‘ç»“æœã€‚\n\n## ğŸ“Š é…ç½®è¯´æ˜\n### 1. éƒ¨ç½² Gemini CLI API\n```\npython main.py\n```\n### 2. é…ç½®å·¥ä½œæµ\n- æ›¿æ¢ Google Cloud é¡¹ç›®ID\n- ç›®æ ‡è¯­è¨€å¯åœ¨â€œæ ¼å¼åŒ–ç¿»è¯‘ç»“æœâ€èŠ‚ç‚¹è‡ªè¡Œæ‰©å±•\n\n",
        "height": 880,
        "width": 1820,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        140,
        -380
      ],
      "id": "38d5df8a-c18d-401e-acb9-a4792cc5dd70",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## APIè°ƒç”¨ç¤ºä¾‹\n```bash\ncurl -X POST http://localhost:5678/webhook/translate \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"text\": \"Hello, how are you today?\",\n    \"target_languages\": [\"ä¸­æ–‡\", \"æ—¥è¯­\", \"æ³•è¯­\"]\n  }'\n```\n\n## å“åº”æ ¼å¼\n\n```json\n{\n  \"success\": true,\n  \"original_text\": \"Hello, how are you today?\",\n  \"requested_languages\": [\"Chinese\", \"Japanese\", \"French\"],\n  \"translations\": {\n    \"Chinese\": \"ä½ å¥½ï¼Œä½ ä»Šå¤©æ€ä¹ˆæ ·ï¼Ÿ\",\n    \"Japanese\": \"ã“ã‚“ã«ã¡ã¯ã€ä»Šæ—¥ã¯ã„ã‹ãŒã§ã™ã‹ï¼Ÿ\",\n    \"French\": \"Bonjour, comment allez-vous aujourd'hui ?\"\n  },\n  \"extracted_count\": 3,\n  \"timestamp\": \"2024-01-15T10:30:00.000Z\",\n  \"model_used\": \"gemini-2.5-pro\",\n  \"request_id\": \"req_123456789\"\n}\n```",
        "height": 880,
        "width": 920,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2000,
        -380
      ],
      "id": "a29073e0-2eed-4cfb-a737-c3f8ccb8d976",
      "name": "Sticky Note1"
    }
  ],
  "pinData": {
    "ç¿»è¯‘è¯·æ±‚": [
      {
        "json": {
          "headers": {
            "host": "localhost:5678",
            "user-agent": "curl/8.7.1",
            "accept": "*/*",
            "content-type": "application/json",
            "content-length": "110"
          },
          "params": {},
          "query": {},
          "body": {
            "text": "Hello, how are you today?",
            "target_languages": [
              "ä¸­æ–‡",
              "æ—¥è¯­",
              "æ³•è¯­"
            ]
          },
          "webhookUrl": "http://localhost:5678/webhook/translate",
          "executionMode": "production"
        }
      }
    ]
  },
  "connections": {
    "ç¿»è¯‘è¯·æ±‚": {
      "main": [
        [
          {
            "node": "è®¾ç½® Google Cloud é¡¹ç›®ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini ç¿»è¯‘": {
      "main": [
        [
          {
            "node": "æ ¼å¼åŒ–ç¿»è¯‘ç»“æœ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ ¼å¼åŒ–ç¿»è¯‘ç»“æœ": {
      "main": [
        [
          {
            "node": "è¿”å›ç¿»è¯‘ç»“æœ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "é”™è¯¯å¤„ç†": {
      "main": [
        [
          {
            "node": "é”™è¯¯å“åº”",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è®¾ç½® Google Cloud é¡¹ç›®ID": {
      "main": [
        [
          {
            "node": "Gemini ç¿»è¯‘",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "a67ff76a-0ab2-4105-8a80-72c65183d6cd",
  "meta": {
    "instanceId": "1bcceb694542a87d03dcbfc74b010fcbb893175a18a9dab6ba2e57e028f57403"
  },
  "id": "v8BWCDdLu9WpPZAq",
  "tags": []
}