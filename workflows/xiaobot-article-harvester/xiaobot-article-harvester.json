{
  "name": "Xiaobot Article Harvester",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        40,
        -80
      ],
      "id": "8de37f29-6ebf-4bb9-8727-ca07faa25aa3",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $node['é…ç½®ä¸“æ å‚æ•°'].json.crawl4ai_server }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"urls\": [\"{{ $json.target_url }}\"],\n  \"browser_config\": {\n    \"type\": \"BrowserConfig\", \n    \"params\": {\n      \"headless\": true,\n      \"viewport\": {\"type\": \"dict\", \"value\": {\"width\": 1200, \"height\": 800}},\n      \"headers\": {\n        \"authorization\": \"Bearer {{ $json.xiaobot_authorization }}\",\n        \"user-agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36\"\n      }\n    }\n  },\n  \"crawler_config\": {\n    \"type\": \"CrawlerRunConfig\",\n    \"params\": {\n      \"page_timeout\": 180000,\n      \"wait_until\": \"networkidle\",\n      \"delay_before_return_html\": 5.0,\n      \"js_code\": [\n        \"window.apiData = []; const originalXHR = window.XMLHttpRequest; window.XMLHttpRequest = function() { const xhr = new originalXHR(); const originalOpen = xhr.open; const originalSend = xhr.send; xhr.open = function(method, url) { this._url = url; return originalOpen.apply(this, arguments); }; xhr.send = function(data) { if (this._url && this._url.includes('api.xiaobot.net')) { const originalOnReadyStateChange = this.onreadystatechange; this.onreadystatechange = function() { if (this.readyState === 4 && this.status === 200) { try { const data = JSON.parse(this.responseText); window.apiData.push(data); } catch(e) { } } if (originalOnReadyStateChange) originalOnReadyStateChange.apply(this, arguments); }; } return originalSend.apply(this, arguments); }; return xhr; };\",\n        \"document.querySelector('div.active')?.click();\",\n        \"await new Promise(resolve => setTimeout(resolve, 5000));\",\n        \"let lastApiCount = 0; let noNewDataCount = 0; for(let i=0; i<50; i++) { window.scrollTo(0, document.body.scrollHeight); await new Promise(resolve => setTimeout(resolve, 5000)); if(window.apiData.length === lastApiCount) { noNewDataCount++; if(noNewDataCount >= 3) break; } else { noNewDataCount = 0; lastApiCount = window.apiData.length; } }\",\n        \"await new Promise(resolve => setTimeout(resolve, 5000)); window.n8nResult = { articles: [], totalCount: 0, metadata: { timestamp: new Date().toISOString(), source: 'xiaobot', totalApiCalls: window.apiData.length } }; window.apiData.forEach(apiResponse => { if (apiResponse.data && Array.isArray(apiResponse.data)) { apiResponse.data.forEach(article => { window.n8nResult.articles.push({ id: article.uuid, title: article.title, content: article.content, published_at: article.created_at, tags: article.tag_names || [] }); }); } }); window.n8nResult.totalCount = window.n8nResult.articles.length; return window.n8nResult;\"\n      ],\n      \"css_selector\": \"#posts\",\n      \"cache_mode\": \"bypass\"\n    }\n  }\n}",
        "options": {
          "timeout": 1000000
        }
      },
      "id": "43f625a8-76fc-4421-a016-4899be781506",
      "name": "Crawl4AIè·å–æ•°æ®å°æŠ¥ç«¥",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        700,
        -300
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "4NxmCFNHrCOyEniT",
          "name": "Crawl4 Header Auth account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        320,
        100
      ],
      "id": "314dda3c-4a9d-49a1-83ab-4ef81050cb9f",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "content": "## å°æŠ¥ç«¥æ–‡ç« è‡ªåŠ¨ä¸‹è½½\n\n### ğŸ“‹ åŸºæœ¬ä¿¡æ¯\n- å·¥ä½œæµåç§°: Xiaobot Article Harvester\n- ç‰ˆæœ¬: v1.0.0\n- åˆ›å»ºè€…: LQ\n- å¾®ä¿¡ï¼šcloud-native-101\n- å…¬ä¼—å·: æ—æœˆåŠå­çš„AIç¬”è®°\n\n### ğŸ¯ åŠŸèƒ½æ¦‚è¿°\nè¿™ä¸ªå·¥ä½œæµå®ç°äº†ä»å°æŠ¥ç«¥(Xiaobot)å¹³å°è‡ªåŠ¨æ‰¹é‡ä¸‹è½½æ–‡ç« å†…å®¹å¹¶è½¬æ¢ä¸º Markdown æ ¼å¼æ–‡ä»¶çš„å®Œæ•´æµç¨‹ã€‚é€šè¿‡æ¨¡æ‹Ÿæµè§ˆå™¨è¡Œä¸º**ç»•è¿‡åŠ¨æ€ API ç­¾åé™åˆ¶**ï¼Œå®ç°å…¨è‡ªåŠ¨åŒ–çš„æ–‡ç« é‡‡é›†ä¸æ ¼å¼è½¬æ¢ã€‚\n\n\n### å·¥ä½œæµä¼˜åŠ¿\n  1. è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜: ä¸€é”®å®Œæˆä»è®¿é—®åˆ°ä¿å­˜çš„å…¨æµç¨‹\n  2. ç»•è¿‡æŠ€æœ¯é™åˆ¶: å·§å¦™è§£å†³åŠ¨æ€ API ç­¾åé—®é¢˜\n  3. æ•°æ®å®Œæ•´æ€§: é€šè¿‡æ— é™æ»šåŠ¨è·å–\n\n### é…ç½®è¯´æ˜\n1. é…ç½®å°æŠ¥ç«¥ä¸“æ åœ°å€ï¼šå°† `YOUR_COLUMN_ID` æ›¿æ¢ä¸ºé‡‡é›†ä¸“æ ID\n2. é…ç½®å°æŠ¥ç«¥ authorizationï¼šå°† `YOUR_XIAOBOT_TOKEN_HERE` æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ Authorization",
        "height": 780,
        "width": 580
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -340,
        -420
      ],
      "id": "43403e42-e846-4a2d-9d9f-0eb41eb15c4c",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## é…ç½®ä¸“æ å‚æ•° \né…ç½®å°æŠ¥ç«¥ä¸“æ  URL å’Œ è®¤è¯ä¿¡æ¯",
        "height": 300,
        "width": 320,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        260,
        -420
      ],
      "id": "ca98d058-903c-44f1-8e9c-ec223a08ab7a",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## æŠ“å–å°æŠ¥ç«¥æ–‡ç« \n- ä½¿ç”¨ Crawl4AI æ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®å°æŠ¥ç«¥å¹¶æ‹¦æˆª API å“åº”\n- ğŸ“¢ åŒ…å«æ‰€æœ‰æ–‡ç« ä¿¡æ¯çš„ç»“æ„åŒ– JSON æ•°æ®(**æ‰€ä»¥æœ‰ç‚¹æ…¢**)\n- å°†æ–‡ç« æ•°ç»„æ‹†åˆ†ä¸ºå•ä¸ªæ–‡ç« é¡¹",
        "height": 300,
        "width": 700,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        640,
        -420
      ],
      "id": "b5b8fe5d-7f36-4920-a92d-5cfc996a1a98",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "fieldToSplitOut": "results[0].js_execution_result.results[4].articles",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        1160,
        -260
      ],
      "id": "f6e4fed8-0550-482c-8aa5-22eecec5df9f",
      "name": "æ‹†åˆ†æ–‡ç« åˆ—è¡¨"
    },
    {
      "parameters": {
        "jsCode": "// è·å– raw_markdown å†…å®¹\nconst rawMarkdown = $input.first().json.data;\n\n// è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°æ®\nconst binaryData = Buffer.from(rawMarkdown, 'utf8');\n\nconst item = $input.first().json;\n\n// å®‰å…¨çš„æ–‡ä»¶åæ¸…ç†å‡½æ•°\nfunction createSafeFilename(title) {\n  if (!title) return 'untitled';\n  \n  return title\n    .replace(/[\\/\\\\:*?\"<>|]/g, '-')    // æ›¿æ¢éæ³•å­—ç¬¦ä¸ºæ¨ªçº¿\n    .replace(/\\s+/g, '_')              // ç©ºæ ¼æ›¿æ¢ä¸ºä¸‹åˆ’çº¿\n    .replace(/-{2,}/g, '-')            // å¤šä¸ªæ¨ªçº¿åˆå¹¶\n    .replace(/_{2,}/g, '_')            // å¤šä¸ªä¸‹åˆ’çº¿åˆå¹¶\n    .replace(/^[-_]+|[-_]+$/g, '')     // ç§»é™¤é¦–å°¾çš„æ¨ªçº¿ä¸‹åˆ’çº¿\n    .substring(0, 80);                 // é™åˆ¶é•¿åº¦\n}\n\nconst safeTitle = createSafeFilename(item.title);\nconst publishDate = $input.first().json.published_at ? $input.first().json.published_at.split('T')[0] : 'unknown';\n\n\n// è¿”å›äºŒè¿›åˆ¶æ•°æ®\nreturn [{\n  binary: {\n    data: {\n      data: binaryData.toString('base64'),\n      mimeType: 'text/markdown',\n      fileName: `${publishDate}_${safeTitle}`\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        780,
        120
      ],
      "id": "0fbd2e3b-df9f-42c3-a262-1143b89842d2",
      "name": "å¤„ç†æ–‡ä»¶ä¿¡æ¯"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1180,
        120
      ],
      "id": "94609b6a-d610-428f-9751-0ddc444410d5",
      "name": "å†™å…¥å»¶è¿Ÿ",
      "webhookId": "10f5b913-2afa-4219-b429-cf2c3641b470"
    },
    {
      "parameters": {
        "content": "## æ–‡ç« å¤„ç†ä¸ä¿å­˜\n  - å¾ªç¯å¤„ç†æ¯ç¯‡æ–‡ç« ï¼Œè½¬æ¢æ ¼å¼å¹¶ä¿å­˜ä¸ºæœ¬åœ°æ–‡ä»¶\n  - å¯¹æ¯ä¸ªæ–‡ç« é¡¹è¿›è¡ŒHTMLåˆ°Markdownè½¬æ¢å’Œæ–‡ä»¶å†™å…¥æ“ä½œ",
        "height": 440,
        "width": 1080,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        260,
        -80
      ],
      "id": "e749bd85-6589-4bea-896a-b22176fb4b71",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "html": "={{ $json.content }}",
        "options": {}
      },
      "type": "n8n-nodes-base.markdown",
      "typeVersion": 1,
      "position": [
        580,
        120
      ],
      "id": "b68755aa-f611-43ec-854c-2192510f321c",
      "name": "HTML è½¬ Markdown"
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "=/tmp/{{ $binary.data.fileName }}.md",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        980,
        120
      ],
      "id": "ac531e78-1902-4ec2-9446-3b77af8e631b",
      "name": "ä¿å­˜ Markdown æ–‡ä»¶"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "973d2cdb-d4dc-4533-bbb7-6445beb13a8d",
              "name": "crawl4ai_server",
              "value": "http://host.docker.internal:11235/crawl",
              "type": "string"
            },
            {
              "id": "7a42dfa4-b43a-44eb-a1ae-39f5eb37ee3f",
              "name": "target_url",
              "value": "https://www.xiaobot.net/p/<YOUR_COLUMN_ID>",
              "type": "string"
            },
            {
              "id": "f2208a2d-847c-4134-8d8c-02b7c710ffe2",
              "name": "xiaobot_authorization",
              "value": "<YOUR_XIAOBOT_TOKEN_HERE>",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "0eabfa5e-3611-421b-bf41-00a8f9067a3b",
      "name": "é…ç½®ä¸“æ å‚æ•°",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        360,
        -300
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2f58ac4f-517e-404c-b7d8-9da8cc8930b6",
              "leftValue": "={{ $json.results[0].js_execution_result.results[4].totalCount }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        900,
        -300
      ],
      "id": "4ffc96fd-9870-46af-be90-daff55c218eb",
      "name": "If"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1160,
        -400
      ],
      "id": "b306bdbc-7997-43cb-b60b-d9a3fc8e1bb5",
      "name": "No Operation, do nothing"
    }
  ],
  "pinData": {},
  "connections": {
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "é…ç½®ä¸“æ å‚æ•°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crawl4AIè·å–æ•°æ®å°æŠ¥ç«¥": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "HTML è½¬ Markdown",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ‹†åˆ†æ–‡ç« åˆ—è¡¨": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¤„ç†æ–‡ä»¶ä¿¡æ¯": {
      "main": [
        [
          {
            "node": "ä¿å­˜ Markdown æ–‡ä»¶",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å†™å…¥å»¶è¿Ÿ": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML è½¬ Markdown": {
      "main": [
        [
          {
            "node": "å¤„ç†æ–‡ä»¶ä¿¡æ¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ä¿å­˜ Markdown æ–‡ä»¶": {
      "main": [
        [
          {
            "node": "å†™å…¥å»¶è¿Ÿ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "é…ç½®ä¸“æ å‚æ•°": {
      "main": [
        [
          {
            "node": "Crawl4AIè·å–æ•°æ®å°æŠ¥ç«¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "æ‹†åˆ†æ–‡ç« åˆ—è¡¨",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "ce081092-ffdb-4f0c-947b-6c8afbbd567a",
  "meta": {
    "instanceId": "1bcceb694542a87d03dcbfc74b010fcbb893175a18a9dab6ba2e57e028f57403"
  },
  "id": "LSrBN6nAebiFqw8j",
  "tags": []
}